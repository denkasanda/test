name: Automate File Move and Update on Merge

on:
  push:
    branches:
      - main  # Workflow ini akan dijalankan saat ada push ke branch main

jobs:
  move-and-update-files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Ensure libs/{nama_libs} folders exist
        run: |
          # Memastikan folder libs/ sudah ada dan membuat sub-folder jika diperlukan
          mkdir -p libs

      - name: Move files to appropriate libs folder
        run: |
          echo "Memindahkan file dari root ke libs/{nama_libs}"
          EXCLUDE_FILES=".gitignore .github libs"
          
          # Loop untuk mencari folder yang ada di dalam libs/
          for dir in libs/*/; do
            if [ -d "$dir" ]; then
              echo "Folder found: $dir"
              # Loop untuk memindahkan file ke folder yang sesuai
              for file in $(ls); do
                if [[ ! " ${EXCLUDE_FILES} " =~ " ${file} " && -f "$file" ]]; then
                  echo "Memindahkan $file ke $dir"
                  git mv "$file" "$dir" || echo "Skipping $file, already moved or not found"
                fi
              done
            fi
          done


      - name: Commit the moved/updated files
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add .
          git commit -m "Move and update root files to the correct libs/{nama_libs} folder after merge" || echo "No changes to commit"
          git push origin main
